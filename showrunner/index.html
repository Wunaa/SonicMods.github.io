<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Discord Show Runner Webhook</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #2c2f33;
      color: #fff;
      padding: 20px;
    }
    h1 { 
      text-align: center; 
      margin-bottom: 20px;
    }
    .layout {
      display: flex;
      gap: 20px;
    }
    .container {
      flex: 2;
      background: #23272a;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    .preview {
      flex: 1;
      background: #2c2f33;
      padding: 15px;
      border-radius: 12px;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid #444;
    }
    .preview h2 {
      font-size: 1.1em;
      margin-bottom: 10px;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    /* Discord message style */
    .discord-message {
      display: flex;
      margin-bottom: 15px;
    }
    .discord-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
      background: #555;
      flex-shrink: 0;
      object-fit: cover;
    }
    .discord-content {
      flex: 1;
    }
    .discord-username {
      font-weight: bold;
      color: #fff;
    }
    .discord-time {
      font-size: 0.75em;
      color: #888;
      margin-left: 5px;
    }
    .discord-text {
      margin-top: 2px;
      white-space: pre-wrap;
    }
    .discord-embed {
      background: #2f3136;
      border-left: 4px solid #7289da;
      padding: 10px;
      border-radius: 4px;
      margin-top: 8px;
    }
    .embed-title {
      font-weight: bold;
      color: #fff;
      margin-bottom: 5px;
    }
    .embed-desc {
      color: #ccc;
      font-size: 0.9em;
    }
    .embed-image {
      margin-top: 8px;
      max-width: 100%;
      border-radius: 6px;
    }
    section {
      margin-bottom: 25px;
      padding: 15px;
      background: #2c2f33;
      border-radius: 10px;
    }
    section h2 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.2em;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    label { display: block; margin-top: 10px; }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 6px;
      border: none;
      background: #99aab5;
      color: #000;
    }
    textarea { height: 80px; resize: vertical; }
    button {
      margin-top: 10px;
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    button:hover { opacity: 0.9; }
    .send { background: #7289da; color: #fff; width: 100%; }
    .save { background: #43b581; color: #fff; width: 49%; }
    .edit { background: #faa61a; color: #000; width: 49%; }
    .quick { background: #5865f2; color: #fff; margin-top: 5px; width: 32%; }
    .row { display: flex; gap: 10px; }
    .row > div { flex: 1; }
    .log {
      max-height: 200px;
      overflow-y: auto;
      background: #202225;
      padding: 10px;
      border-radius: 6px;
      font-size: 0.9em;
    }
    .log-entry {
      display: flex;
      justify-content: space-between;
      background: #2c2f33;
      padding: 5px 8px;
      border-radius: 5px;
      margin-bottom: 5px;
      align-items: center;
    }
    .log-entry span {
      flex: 1;
      color: #ccc;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .log-entry button {
      background: #faa61a;
      color: #000;
      font-size: 0.8em;
      padding: 5px 10px;
      width: auto;
    }
  </style>
</head>
<body>
  <h1>🎬 Show Runner Webhook</h1>
  <div class="layout">
    <div class="container">
      <section>
        <h2>Webhook Settings</h2>
        <label>Webhook URL</label>
        <input type="text" id="webhook" placeholder="Paste your Discord Webhook URL">

        <label>Username Override</label>
        <input type="text" id="username" placeholder="Optional username">

        <label>Avatar URL Override</label>
        <input type="text" id="avatar" placeholder="Optional avatar URL">

        <div class="row">
          <button class="save" onclick="saveSettings()">💾 Save Settings</button>
          <button class="edit" onclick="loadSettings()">📂 Load Settings</button>
        </div>
      </section>

      <section>
        <h2>Message</h2>
        <label>Content</label>
        <textarea id="content" placeholder="Type your announcement..."></textarea>
        <small id="charCount">0 / 2000</small>

        <h3>Embed Options</h3>
        <div class="row">
          <div>
            <label>Title</label>
            <input type="text" id="embedTitle">
          </div>
          <div>
            <label>Color</label>
            <input type="color" id="embedColor" value="#7289da">
          </div>
        </div>
        <label>Description</label>
        <textarea id="embedDescription"></textarea>

        <label>Image URL</label>
        <input type="text" id="embedImage">

        <label>Footer</label>
        <input type="text" id="embedFooter">

        <label><input type="checkbox" id="embedTimestamp"> Include timestamp</label>

        <button class="send" onclick="sendWebhook()">🚀 Send Message</button>
      </section>

      <section>
        <h2>Quick Announcements</h2>
        <div class="row">
          <button class="quick" onclick="quickSend('🍿 Movie starting now! Join in!')">Movie Start</button>
          <button class="quick" onclick="quickSend('📺 Show is starting! Get ready!')">Show Start</button>
          <button class="quick" onclick="quickSend('✅ That’s a wrap! Thanks for watching!')">End Announcement</button>
        </div>
      </section>

      <section>
        <h2>Message Log</h2>
        <div class="log" id="messageLog">
          <p style="color:#666;">No messages sent yet.</p>
        </div>
      </section>
    </div>

    <div class="preview">
      <h2>Preview</h2>
      <div id="previewMessage" class="discord-message">
        <img id="previewAvatar" class="discord-avatar" src="" alt="">
        <div class="discord-content">
          <div>
            <span id="previewUsername" class="discord-username">Webhook Bot</span>
            <span class="discord-time">Today at 12:00</span>
          </div>
          <div id="previewContent" class="discord-text">Your message will appear here...</div>
          <div id="previewEmbed" class="discord-embed" style="display:none;">
            <div id="embedPreviewTitle" class="embed-title"></div>
            <div id="embedPreviewDesc" class="embed-desc"></div>
            <img id="embedPreviewImage" class="embed-image" src="">
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const webhookInput = document.getElementById("webhook");
    const contentInput = document.getElementById("content");
    const charCount = document.getElementById("charCount");
    const log = document.getElementById("messageLog");

    // Preview elements
    const previewUsername = document.getElementById("previewUsername");
    const previewAvatar = document.getElementById("previewAvatar");
    const previewContent = document.getElementById("previewContent");
    const previewEmbed = document.getElementById("previewEmbed");
    const embedPreviewTitle = document.getElementById("embedPreviewTitle");
    const embedPreviewDesc = document.getElementById("embedPreviewDesc");
    const embedPreviewImage = document.getElementById("embedPreviewImage");

    let messages = [];

    // Character counter
    contentInput.addEventListener("input", () => {
      charCount.textContent = `${contentInput.value.length} / 2000`;
      updatePreview();
    });

    // Update preview live
    document.querySelectorAll("#username, #avatar, #embedTitle, #embedDescription, #embedImage").forEach(el => {
      el.addEventListener("input", updatePreview);
    });

    function updatePreview() {
      previewUsername.textContent = document.getElementById("username").value || "Webhook Bot";
      previewAvatar.src = document.getElementById("avatar").value || "https://cdn.discordapp.com/embed/avatars/0.png";
      previewContent.textContent = contentInput.value || "Your message will appear here...";

      const title = document.getElementById("embedTitle").value;
      const desc = document.getElementById("embedDescription").value;
      const img = document.getElementById("embedImage").value;

      if (title || desc || img) {
        previewEmbed.style.display = "block";
        embedPreviewTitle.textContent = title;
        embedPreviewDesc.textContent = desc;
        embedPreviewImage.src = img;
        embedPreviewImage.style.display = img ? "block" : "none";
      } else {
        previewEmbed.style.display = "none";
      }
    }

    function saveSettings() {
      const settings = {
        webhook: webhookInput.value,
        username: document.getElementById("username").value,
        avatar: document.getElementById("avatar").value,
      };
      localStorage.setItem("webhookSettings", JSON.stringify(settings));
      alert("✅ Settings saved!");
    }

    function loadSettings() {
      const saved = JSON.parse(localStorage.getItem("webhookSettings"));
      if (saved) {
        webhookInput.value = saved.webhook || "";
        document.getElementById("username").value = saved.username || "";
        document.getElementById("avatar").value = saved.avatar || "";
        updatePreview();
        alert("📂 Settings loaded!");
      }
    }

    function buildPayload() {
      const payload = {
        content: contentInput.value || undefined,
        username: document.getElementById("username").value || undefined,
        avatar_url: document.getElementById("avatar").value || undefined,
        embeds: []
      };

      const embed = {};
      const title = document.getElementById("embedTitle").value;
      const description = document.getElementById("embedDescription").value;
      const color = document.getElementById("embedColor").value;
      const image = document.getElementById("embedImage").value;
      const footer = document.getElementById("embedFooter").value;
      const timestamp = document.getElementById("embedTimestamp").checked;

      if (title || description || image || footer || timestamp) {
        if (title) embed.title = title;
        if (description) embed.description = description;
        if (color) embed.color = parseInt(color.slice(1), 16);
        if (image) embed.image = { url: image };
        if (footer) embed.footer = { text: footer };
        if (timestamp) embed.timestamp = new Date();
        payload.embeds.push(embed);
      }
      return payload;
    }

    async function sendWebhook() {
      const url = webhookInput.value;
      if (!url) return alert("Webhook URL required!");
      const payload = buildPayload();

      try {
        const res = await fetch(url + "?wait=true", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          const data = await res.json();
          addToLog(data.id, payload.content || "[Embed]");
          contentInput.value = "";
          charCount.textContent = "0 / 2000";
          updatePreview();
        } else {
          alert("❌ Error sending message. Check the webhook URL.");
        }
      } catch (e) {
        alert("❌ Network error: " + e.message);
      }
    }

    async function editMessage(id) {
      const url = webhookInput.value;
      if (!url) return alert("Webhook URL required!");
      const payload = buildPayload();

      try {
        const res = await fetch(url + "/messages/" + id, {
          method: "PATCH",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          alert("✏️ Message edited!");
          updateLog(id, payload.content || "[Embed]");
        } else {
          alert("❌ Error editing message.");
        }
      } catch (e) {
        alert("❌ Network error: " + e.message);
      }
    }

    function quickSend(message) {
      contentInput.value = message;
      updatePreview();
      sendWebhook();
    }

    function addToLog(id, content) {
      if (log.querySelector("p")) log.innerHTML = ""; // remove "no messages yet"

      const entry = document.createElement("div");
      entry.className = "log-entry";
      entry.innerHTML = `
        <span>${content}</span>
        <button onclick="editMessage('${id}')">✏️ Edit</button>
      `;
      log.prepend(entry);
      messages.push({ id, content });
    }

    function updateLog(id, newContent) {
      const entries = log.getElementsByClassName("log-entry");
      for (let e of entries) {
        if (e.innerHTML.includes(id)) {
          e.querySelector("span").textContent = newContent;
        }
      }
    }

    // Init preview
    updatePreview();
  </script>
</body>
</html>
